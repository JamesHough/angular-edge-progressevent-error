<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>EdgeHttpGetProgresseventError</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script type="text/javascript">
      function ajaxSuccess() {
        console.log(this.responseText);
      }

      function getDecendantElementByName(element, name) {
        if (element === null || element === undefined || !name) {
          return null;
        }

        if (element.name === name) {
          return element;
        }

        let found = null;
        for (let i = 0; i < element.childNodes.length; i++) {
          found = getDecendantElementByName(element.childNodes[i], name);

          if (found) {
            return found;
          }
        }

        return null;
      }

      function AJAXSubmit(f) {
        let data = new FormData();
        data.append(
          'file',
          getDecendantElementByName(f, 'file').files[0],
          'file-name-here.dat'
        );

        let ajaxReq = new XMLHttpRequest();
        ajaxReq.onload = ajaxSuccess;
        ajaxReq.open('POST', f.action);

        if (f.enctype === 'multipart/form-data') {
          /* enctype is  */
          let sBoundary =
            '---------------------------' + Date.now().toString(16);

          ajaxReq.setRequestHeader(
            'Content-Type',
            'multipart/form-data; boundary=' + sBoundary
          );

          ajaxReq.sendAsBinary(
            '--' +
              sBoundary +
              '\r\n' +
              data.segments.join('--' + sBoundary + '\r\n') +
              '--' +
              sBoundary +
              '--\r\n'
          );
        } else {
          ajaxReq.setRequestHeader('Content-Type', f.enctype);
          ajaxReq.send(
            data.segments.join(f.enctype === 'text/plain' ? '\r\n' : '&')
          );
        }
      }
    </script>
  </head>
  <body>
    <form
      method="POST"
      onsubmit="AJAXSubmit(this); return false;"
      action="http://slbappprd128v:3000/api/excel-reader-api/api/ReadColumnHeaders"
      enctype="multipart/form-data"
    >
      <h3>Simple HTML Upload (No Angular)</h3>
      <p>
        This part of the page is uploading with XHR directly to a service
        without using Angular.
      </p>
      <div>
        <label>File to upload <input type="file" name="file"/></label>
        <input type="hidden" name="fileName" value="file-name-here.txt" />
      </div>
      <div>
        <input type="submit" value="Upload" />
      </div>
    </form>
    <hr />
    <app-root></app-root>
  </body>
</html>
